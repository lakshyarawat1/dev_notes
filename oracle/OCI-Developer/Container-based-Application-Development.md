# Container based application development

## Containerization

- Create a unified software package as containers
- Brings virtualization to operating system level
- Container engines serves as the runtime environment.
- Shares only the operating systems and hold only the application and related binaries.
- Ensures platform-independence
- Less overhead than virtual machines.
- Shares the same OS kernel

## Docker

### Components

- Docker client : User, client, docker CLI or UI
- Docker Daemon : Contains images and containers, and fires them up, execute commands sent by client
- Docker registry : Stores pre-built and custom docker templates and images to use.
- Client communicates with daemon using REST APIs

### Basic commands

- `docker run` : Creates and runs a container
    - `-p` : to map the port of the container to your machine
    - `-it` : to run container in the interactive mode
    - `-d` : to run container in detatched mode
    - `--name` : gives custom name to your container
- `docker start` : Starting a stopped container
- `docker stop` : Stopping a running container
- `docker restart` : Restarting a running container
- `docker inspect` : Inspects a running container
- `docker logs` : View docker container logs
- `docker ps` : List running containers  
    -  -a flag to list all stopped containers
- `docker rm` : Removing a container
- `docker exec` : Runs a command in the running container
- `docker image pull [IMAGE_NAME]` : Pulling a docker image from the Docker Hub
- `docker build -f [DOCKERFILE_PATH]` : Building an image from a DockerFile
- `docker commit [CONTAINER_NAME] [IMAGE_NAME]` : Building an image from a container
- `docker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]` : Tagging a docker image
- `docker login && docker image push [IMAGE_NAME]` : Pusing an image to Docker Hub
- `docker image ls || docker images` : List container images
- `docker image remove [IMAGE_NAME] || docker rmi [IMAGE_NAME]` : Deleting an image from the system
- 


### DockerFile

- Text file that contains all commands a user can call on the command line to assemble an image
- Create an automated build that executes several command-line instructions in succession by using docker build.

### DockerFile Commands

- `FROM` : Specifies base image, always the first command
- `RUN` : Executes specified command
- `WORKDIR` : Change current directory
- `COPY` : Simply copy of files/ directories from host machine to container image
- `ENV` : Adds environmental variables
- `EXPOSE` : Open designated port
- `CMD` : Specify the command at the time of container execution (can be overridden)
- `ENTRYPOINT` : Specify the command to execute the container
- `LABEL` : Specifies the author of the file and more. (maintainer)

## OCIR

- a.k.a. Oracle Cloud Infrastructure Registry is an oracle managed registry
- Enables easy storage, sharing and management of container images.
- Supports pushing and pulling container images via CLI from Private and Public OCIR repositories
- OCIR is compliant with Open Container Initiative (OCI) standards.  
- Supports for multi-architecture images and Helm Charts
- Supports private access from Oracle Cloud Infrastructure resources in Virtual Cloud Network (VCN) through a service gateway.

### Benefits

- Integration
- Security
- Regional Availability
- High availability
- Anywhere access
- Repository Quotas

### Container registry concepts

- Images : read-only templates with instructions for creating a container, stores any artifacts like docker images, manifest lists or helm charts.
- Repository : Meaningfully named collection of related images. Different versions of same source image grouped. User need a OCI username and auth token to push or pull image for OCIR
- Region key : Region which the OCIR is using
- Tenancy namespace : autogenerated
- Registry Identifier : Combination of region key and tenancy namespace. Syntax is `<region-key>.ocir.io<tenancy-namespace>`
- Tag : specifies different versions of the image
- Image name : <repo-name>:<tag>
- image path : <region-key>.ocir.io/<tenancy-namespace>/<repo-name>:<tag>

## Images Concepts

- image-spec : 
    - defines how to create an OCI image, which includes image manifests, file system serialization, and image configurations
- runtime-spec : 
    - defines how to run the OCI image bundle as a container
    - Container runtime performs some or all of the following tasks : 
        - Container image management
        - Container lifecycle management
        - Container creation
        - Container resource management
    - Examples include : 
        - ContainerD
        - rkt
        - cri-o
        - runc

### OCI Image Layout

- Is a slash seperated layout of OCI content-addressable blobs and location-addessable references.
- Components : 
    - oci-layout : Provides the version of the layout
    - index.json : Must to have, entry point for the references
    - blobs/sha256 : Its children contains the actual content 

## OCIR Management

### Managing repositories

- Creating a repository
- Deleting a repository
- Moving a repository into compartments

### Managing images

- View images and image details
- Pushing/Pulling images from Docker Hub
- Deleting and undeleting (48hrs) images
- Retaining and deleting images using retention policies
- Untagging images
- Pulling images from container registry during kubernetes deployment

### Managing security

- Policies to control repository access
- Getting an auth token
- Scanning images for vulnerabilities

### Preparing for Container Registry

- Access to OCI tenancy : The tenancy must be subscribed to one or more of the regions in which container registry is available.
- Docker on local machine : Access to Docker CLI
- Create policy for resources : User must belong to a group to which a policy grants the permission or belong to the tenancy's Admin group
- Generate Auth Token : User must already have an Oracle Cloud Infrastructure username and auth token